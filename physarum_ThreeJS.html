<!DOCTYPE HTML>
<html>
    <head>
        <title>Three.js</title>


        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100%; };
        </style>
    </head>

    <body>
        <script src="js/three.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script type="text/javascript" src="js/stats.min.js"></script>

        <script>
            function httpGet(theUrl) {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.open("GET", theUrl, false); // false for synchronous request
                xmlHttp.send(null);
                return JSON.parse(xmlHttp.responseText);
            }

            function renderPoints(frame, scene) {
                /*
                Given points coordiates (frame) and scene, adds all particles to a scene                
                */
                var geometry = new THREE.SphereGeometry(0.01, 1, 1);
                var material = new THREE.MeshBasicMaterial({color: 0xFFFF00, wireframe: false});
                for (var i = 0; i < frame["x"].length; ++i) {
                    var point = new THREE.Mesh(geometry, material);
                    point.position.x = frame["x"][i];
                    point.position.y = frame["y"][i];
                    point.position.z = frame["z"][i];
                    scene.add(point);
                }
                return scene;
            }
        </script>

        <script>
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            window.addEventListener('resize', function() {
                var width = window.innerWidth;
                var height = window.innerHeight;
                renderer.setSize(width, height);
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
            });

            document.addEventListener('keydown', onDocumentKeyDown, false);
            function onDocumentKeyDown(event) {
                var keyCode = event.which;
                console.log(keyCode);
                if (keyCode == 87) {
                    cube.position.y += 1;
                } else if (keyCode == 83) {
                    cube.position.y -= 1;
                } else if (keyCode == 65) {
                    cube.position.x -= 1;
                } else if (keyCode == 68) {
                    cube.position.x += 1;
                } else if (keyCode == 32) {
                    cube.position.set(0, 0, 0);
                }
            };


            controls = new THREE.OrbitControls(camera, renderer.domElement);

            // create the shape
            var geometry = new THREE.BoxGeometry(1, 1, 1);
            var path = 'https://3docean.img.customer.envatousercontent.com/files/236653866/Featured.jpg?auto=compress%2Cformat&fit=crop&crop=top&w=590&h=590&s=321582fa8635db81a9818e57a69fd28e';
            var cubeMaterials = [
                new THREE.MeshLambertMaterial({map: new THREE.TextureLoader().load(path), side: THREE.DoubleSide}), // RIGHT SIDE
                new THREE.MeshLambertMaterial({map: new THREE.TextureLoader().load(path), side: THREE.DoubleSide}), // LEFT SIDE
                new THREE.MeshLambertMaterial({map: new THREE.TextureLoader().load(path), side: THREE.DoubleSide}), // TOP SIDE
                new THREE.MeshLambertMaterial({map: new THREE.TextureLoader().load(path), side: THREE.DoubleSide}), // BOTTOM SIDE
                new THREE.MeshLambertMaterial({map: new THREE.TextureLoader().load(path), side: THREE.DoubleSide}), // FRONT SIDE
                new THREE.MeshLambertMaterial({map: new THREE.TextureLoader().load(path), side: THREE.DoubleSide})  // BACK SIDE
            ];

            // create a material, color or image texture
            var material = new THREE.MeshFaceMaterial(cubeMaterials);
            var cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            camera.position.z = 3;


            // light
            var ambientLight = new THREE.AmbientLight(0xFFFFFF, 1);
            scene.add(ambientLight);

            var light1 = new THREE.PointLight(0xFFFFFF, 0.5, 500);
            light1.position.x = 3;
            light1.position.y = 2;
            light1.position.z = 2;
            scene.add(light1);

            var geometry = new THREE.SphereGeometry(0.1, 5, 5);
            var material = new THREE.MeshBasicMaterial({color: 0x0000FF, wireframe: true});
            var point = new THREE.Mesh(geometry, material);
            point.position.x = 3;
            point.position.y = 2;
            point.position.z = 2;
            scene.add(point);

            // game logic
            var update = function() {
                // cube.rotation.x += 0.01;
                // cube.rotation.y += 0.005;
            };

            // draw scene
            var render = function() {
                renderer.render(scene, camera);
            };

            // run game loop (update, render, repeat)
            var frameId = 0;
            var GameLoop = function() {
                requestAnimationFrame(GameLoop);
                frameId ++;

                var data = httpGet("http://localhost:8080/get_frame");
                renderPoints(data, scene);

                update();
                render();
            };

            GameLoop();
            function initStats() {
                var stats = new Stats();
                stats.setMode(0); // 0: fps, 1: ms

                // Align top-left
                stats.domElement.style.position = 'absolute';
                stats.domElement.style.left = '0px';
                stats.domElement.style.top = '0px';

                document.body.appendChild( stats.dom );
                return stats;
            }
        </script>
    </body>
</html>